/**
 * DevMentor AI - Teste Completo do Sistema
 * Arquivo para testar todas as funcionalidades implementadas
 */

// ========================================
// TESTE COMPLETO DO SISTEMA
// ========================================

async function testarSistemaCompleto() {
  console.log('üß™ === TESTE COMPLETO DO DEVMENTOR AI ===\n');
  
  try {
    // 1. Testar inicializa√ß√£o do sistema
    console.log('1Ô∏è‚É£ TESTANDO INICIALIZA√á√ÉO...');
    const inicializado = await window.DevMentorHelpers.initializeMediaRichSystem();
    
    if (inicializado) {
      console.log('‚úÖ Sistema inicializado com sucesso!');
    } else {
      console.log('‚ùå Falha na inicializa√ß√£o do sistema');
      return;
    }
    
    // 2. Verificar status de todos os componentes
    console.log('\n2Ô∏è‚É£ VERIFICANDO COMPONENTES...');
    const status = window.DevMentorHelpers.getMediaRichSystemStatus();
    
    const componentes = [
      { nome: 'MediaRichEngine', status: status.mediaRichEngine },
      { nome: 'CitationEngine', status: status.citationEngine },
      { nome: 'InteractivePlayground', status: status.interactivePlayground },
      { nome: 'VisualMetaphorEngine', status: status.visualMetaphorEngine },
      { nome: 'DiagramGenerator', status: status.diagramGenerator },
      { nome: 'AIVideoGenerator', status: status.aiVideoGenerator },
      { nome: 'QuizGenerator', status: status.quizGenerator },
      { nome: 'GeminiProIntegration', status: status.geminiProIntegration },
      { nome: 'CompleteMediaRichDemo', status: status.completeMediaRichDemo },
      { nome: 'DevMentorIndex', status: status.devMentorIndex },
      { nome: 'Estilos CSS', status: status.stylesLoaded }
    ];
    
    componentes.forEach(comp => {
      console.log(`${comp.status ? '‚úÖ' : '‚ùå'} ${comp.nome}`);
    });
    
    console.log(`\nüéØ Sistema Completo: ${status.allComponentsLoaded ? '‚úÖ' : '‚ùå'}`);
    
    // 3. Testar gera√ß√£o de explica√ß√£o rica
    console.log('\n3Ô∏è‚É£ TESTANDO GERA√á√ÉO DE EXPLICA√á√ÉO RICA...');
    
    const codigoTeste = `
async function fetchUserData(userId) {
  try {
    const response = await fetch(\`/api/users/\${userId}\`);
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Erro:', error);
    throw error;
  }
}
    `;
    
    const explicacao = await window.DevMentorHelpers.generateRichExplanation(
      codigoTeste,
      'complexity',
      'javascript',
      'intermediate'
    );
    
    console.log(`‚úÖ Explica√ß√£o gerada: ${explicacao.length} caracteres`);
    console.log(`üé¨ Inclui v√≠deo: ${explicacao.includes('video') ? 'Sim' : 'N√£o'}`);
    console.log(`üìö Inclui cita√ß√µes: ${explicacao.includes('citations') ? 'Sim' : 'N√£o'}`);
    console.log(`üéÆ Inclui playground: ${explicacao.includes('playground') ? 'Sim' : 'N√£o'}`);
    console.log(`üé® Inclui met√°foras: ${explicacao.includes('metaphor') ? 'Sim' : 'N√£o'}`);
    console.log(`üìä Inclui diagramas: ${explicacao.includes('mermaid') ? 'Sim' : 'N√£o'}`);
    console.log(`‚úÖ Inclui quizzes: ${explicacao.includes('quiz') ? 'Sim' : 'N√£o'}`);
    
    // 4. Testar componentes individuais
    console.log('\n4Ô∏è‚É£ TESTANDO COMPONENTES INDIVIDUAIS...');
    
    // CitationEngine
    if (window.citationEngine) {
      const conceitos = [
        { name: 'async/await', confidence: 0.9 },
        { name: 'promises', confidence: 0.8 }
      ];
      
      const citacoes = await window.citationEngine.findCitations(conceitos, 'javascript');
      const totalCitacoes = Object.values(citacoes).reduce((total, cat) => total + (cat ? cat.length : 0), 0);
      console.log(`üìö CitationEngine: ${totalCitacoes} cita√ß√µes encontradas`);
    }
    
    // VisualMetaphorEngine
    if (window.visualMetaphorEngine) {
      const metafora = window.visualMetaphorEngine.getMetaphor('async_await');
      console.log(`üé® VisualMetaphorEngine: ${metafora ? 'Met√°fora encontrada' : 'Nenhuma met√°fora'}`);
    }
    
    // DiagramGenerator
    if (window.diagramGenerator) {
      const diagrama = await window.diagramGenerator.autoGenerateDiagram(codigoTeste, 'complexity');
      console.log(`üìä DiagramGenerator: ${diagrama ? `Diagrama ${diagrama.type} gerado` : 'Nenhum diagrama'}`);
    }
    
    // QuizGenerator
    if (window.quizGenerator) {
      const conceitos = [{ name: 'async/await', confidence: 0.9 }];
      const quizzes = await window.quizGenerator.generateQuizzes(conceitos, 'intermediate');
      console.log(`‚úÖ QuizGenerator: ${quizzes.length} quizzes gerados`);
    }
    
    // 5. Testar playground
    console.log('\n5Ô∏è‚É£ TESTANDO PLAYGROUND...');
    
    if (window.interactivePlayground) {
      const playgroundHTML = window.interactivePlayground.createPlayground(
        'console.log("Hello World!");',
        'javascript',
        { showVisualizer: true }
      );
      console.log(`üéÆ InteractivePlayground: ${playgroundHTML.length} caracteres gerados`);
    }
    
    // 6. Testar Gemini Pro (se configurado)
    console.log('\n6Ô∏è‚É£ TESTANDO GEMINI PRO...');
    
    if (window.geminiProIntegration) {
      const geminiStatus = window.geminiProIntegration.getStatus();
      console.log(`ü§ñ Gemini Pro: ${geminiStatus.isConfigured ? 'Configurado' : 'N√£o configurado'}`);
      
      if (geminiStatus.isConfigured) {
        try {
          const explicacaoInteligente = await window.geminiProIntegration.generateIntelligentExplanation(
            codigoTeste,
            'javascript',
            'complexity',
            'intermediate'
          );
          console.log(`üß† Explica√ß√£o inteligente: ${explicacaoInteligente.mainConcept ? 'Gerada' : 'N√£o gerada'}`);
        } catch (error) {
          console.log(`‚ö†Ô∏è Erro no Gemini Pro: ${error.message}`);
        }
      } else {
        console.log('üí° Para testar Gemini Pro, configure com: window.geminiProIntegration.configure("sua-api-key")');
      }
    }
    
    // 7. Testar demo
    console.log('\n7Ô∏è‚É£ TESTANDO DEMO...');
    
    if (window.completeMediaRichDemo) {
      console.log('üé¨ Demo dispon√≠vel - execute: window.completeMediaRichDemo.runQuickDemo()');
    }
    
    // 8. Testar configura√ß√£o
    console.log('\n8Ô∏è‚É£ TESTANDO CONFIGURA√á√ÉO...');
    
    if (window.devMentorConfig) {
      const config = window.devMentorConfig.getConfig();
      console.log(`‚öôÔ∏è Configura√ß√£o: ${Object.keys(config).length} op√ß√µes dispon√≠veis`);
    }
    
    // 9. Testar √≠ndice
    console.log('\n9Ô∏è‚É£ TESTANDO √çNDICE...');
    
    if (window.DevMentorIndex) {
      console.log(`üìã √çndice: ${window.DevMentorIndex.info.totalComponents} componentes documentados`);
      console.log(`üéØ ${window.DevMentorIndex.info.totalFeatures} funcionalidades listadas`);
    }
    
    // 10. Resumo final
    console.log('\nüéâ === RESUMO DO TESTE ===');
    
    const componentesAtivos = componentes.filter(c => c.status).length;
    const totalComponentes = componentes.length;
    
    console.log(`üìä Componentes Ativos: ${componentesAtivos}/${totalComponentes}`);
    console.log(`üéØ Sistema Completo: ${status.allComponentsLoaded ? '‚úÖ' : '‚ùå'}`);
    console.log(`üìñ Explica√ß√£o Rica: ${explicacao.length > 0 ? '‚úÖ' : '‚ùå'}`);
    console.log(`üé® Estilos CSS: ${status.stylesLoaded ? '‚úÖ' : '‚ùå'}`);
    
    if (componentesAtivos >= 8) {
      console.log('\nüåü SISTEMA FUNCIONANDO PERFEITAMENTE!');
      console.log('üöÄ Pronto para hackathon e demonstra√ß√µes!');
    } else if (componentesAtivos >= 5) {
      console.log('\n‚≠ê SISTEMA FUNCIONANDO PARCIALMENTE');
      console.log('üîß Alguns componentes podem precisar de ajustes');
    } else {
      console.log('\n‚ö†Ô∏è SISTEMA COM PROBLEMAS');
      console.log('üõ†Ô∏è Verifique a inicializa√ß√£o dos componentes');
    }
    
  } catch (error) {
    console.error('‚ùå Erro durante o teste:', error);
  }
}

// ========================================
// TESTE R√ÅPIDO
// ========================================

async function testeRapido() {
  console.log('‚ö° === TESTE R√ÅPIDO ===\n');
  
  try {
    // Inicializar
    await window.DevMentorHelpers.initializeMediaRichSystem();
    
    // Verificar status
    const status = window.DevMentorHelpers.getMediaRichSystemStatus();
    console.log(`üéØ Sistema Completo: ${status.allComponentsLoaded ? '‚úÖ' : '‚ùå'}`);
    
    // Testar explica√ß√£o
    const explicacao = await window.DevMentorHelpers.generateRichExplanation(
      'console.log("test");',
      'complexity',
      'javascript',
      'beginner'
    );
    
    console.log(`üìñ Explica√ß√£o: ${explicacao.length > 0 ? '‚úÖ' : '‚ùå'}`);
    console.log('üéâ Teste r√°pido conclu√≠do!');
    
  } catch (error) {
    console.error('‚ùå Erro no teste r√°pido:', error);
  }
}

// ========================================
// TESTE DE COMPONENTES ESPEC√çFICOS
// ========================================

async function testarComponenteEspecifico(nomeComponente) {
  console.log(`üîç === TESTANDO ${nomeComponente.toUpperCase()} ===\n`);
  
  switch (nomeComponente.toLowerCase()) {
    case 'citation':
      if (window.citationEngine) {
        const citacoes = await window.citationEngine.findCitations(
          [{ name: 'javascript', confidence: 0.8 }],
          'javascript'
        );
        console.log('üìö Cita√ß√µes encontradas:', Object.keys(citacoes).length);
      } else {
        console.log('‚ùå CitationEngine n√£o dispon√≠vel');
      }
      break;
      
    case 'metaphor':
      if (window.visualMetaphorEngine) {
        const metafora = window.visualMetaphorEngine.getMetaphor('async_await');
        console.log('üé® Met√°fora:', metafora?.metaphor || 'N√£o encontrada');
      } else {
        console.log('‚ùå VisualMetaphorEngine n√£o dispon√≠vel');
      }
      break;
      
    case 'diagram':
      if (window.diagramGenerator) {
        const diagrama = await window.diagramGenerator.autoGenerateDiagram(
          'if (true) { console.log("test"); }',
          'complexity'
        );
        console.log('üìä Diagrama:', diagrama?.type || 'N√£o gerado');
      } else {
        console.log('‚ùå DiagramGenerator n√£o dispon√≠vel');
      }
      break;
      
    case 'quiz':
      if (window.quizGenerator) {
        const quizzes = await window.quizGenerator.generateQuizzes(
          [{ name: 'async/await', confidence: 0.9 }],
          'intermediate'
        );
        console.log('‚úÖ Quizzes:', quizzes.length);
      } else {
        console.log('‚ùå QuizGenerator n√£o dispon√≠vel');
      }
      break;
      
    case 'playground':
      if (window.interactivePlayground) {
        const playground = window.interactivePlayground.createPlayground(
          'console.log("Hello!");',
          'javascript'
        );
        console.log('üéÆ Playground:', playground.length > 0 ? 'Criado' : 'N√£o criado');
      } else {
        console.log('‚ùå InteractivePlayground n√£o dispon√≠vel');
      }
      break;
      
    default:
      console.log('‚ùå Componente n√£o reconhecido');
      console.log('Componentes dispon√≠veis: citation, metaphor, diagram, quiz, playground');
  }
}

// ========================================
// TESTE DE PERFORMANCE
// ========================================

async function testarPerformance() {
  console.log('‚ö° === TESTE DE PERFORMANCE ===\n');
  
  const inicio = performance.now();
  
  try {
    // Inicializar sistema
    const initStart = performance.now();
    await window.DevMentorHelpers.initializeMediaRichSystem();
    const initTime = performance.now() - initStart;
    console.log(`üöÄ Inicializa√ß√£o: ${initTime.toFixed(2)}ms`);
    
    // Gerar explica√ß√£o
    const explanationStart = performance.now();
    const explicacao = await window.DevMentorHelpers.generateRichExplanation(
      'function test() { return "hello"; }',
      'complexity',
      'javascript',
      'beginner'
    );
    const explanationTime = performance.now() - explanationStart;
    console.log(`üìñ Explica√ß√£o: ${explanationTime.toFixed(2)}ms`);
    
    // Testar componentes
    const componentsStart = performance.now();
    
    if (window.citationEngine) {
      await window.citationEngine.findCitations([{ name: 'test', confidence: 0.8 }], 'javascript');
    }
    
    if (window.visualMetaphorEngine) {
      window.visualMetaphorEngine.getMetaphor('async_await');
    }
    
    if (window.diagramGenerator) {
      await window.diagramGenerator.autoGenerateDiagram('console.log("test");', 'complexity');
    }
    
    const componentsTime = performance.now() - componentsStart;
    console.log(`üß© Componentes: ${componentsTime.toFixed(2)}ms`);
    
    const totalTime = performance.now() - inicio;
    console.log(`‚è±Ô∏è Tempo Total: ${totalTime.toFixed(2)}ms`);
    
    // Avaliar performance
    if (totalTime < 1000) {
      console.log('üåü Performance Excelente!');
    } else if (totalTime < 3000) {
      console.log('‚≠ê Performance Boa');
    } else {
      console.log('‚ö†Ô∏è Performance pode ser melhorada');
    }
    
  } catch (error) {
    console.error('‚ùå Erro no teste de performance:', error);
  }
}

// ========================================
// EXPORTAR FUN√á√ïES DE TESTE
// ========================================

window.DevMentorTests = {
  testarSistemaCompleto,
  testeRapido,
  testarComponenteEspecifico,
  testarPerformance
};

console.log('üß™ DevMentor Tests carregados!');
console.log('üìã Comandos dispon√≠veis:');
console.log('  - window.DevMentorTests.testarSistemaCompleto()');
console.log('  - window.DevMentorTests.testeRapido()');
console.log('  - window.DevMentorTests.testarComponenteEspecifico("citation")');
console.log('  - window.DevMentorTests.testarPerformance()');







